<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Development FAQ • contextual</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><!-- docsearch --><script src="../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Development FAQ">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">contextual</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.8.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/cmabs.html">Demo: Basic Synthetic cMAB Policies</a>
    </li>
    <li>
      <a href="../../articles/cmabsoffline.html">Demo: Offline cMAB LinUCB evaluation</a>
    </li>
    <li>
      <a href="../../articles/eckles_kaptein.html">Demo: MAB Replication Eckles &amp; Kaptein (Bootstrap Thompson Sampling)</a>
    </li>
    <li>
      <a href="../../articles/epsilongreedy.html">Demo: Basic Epsilon Greedy</a>
    </li>
    <li>
      <a href="../../articles/introduction.html">Getting started: running simulations</a>
    </li>
    <li>
      <a href="../../articles/mabs.html">Demo: MAB Policies Comparison</a>
    </li>
    <li>
      <a href="../../articles/ml10m.html">Demo: MovieLens 10M Dataset</a>
    </li>
    <li>
      <a href="../../articles/offline_depaul_movies.html">Demo: Offline cMAB: CarsKit DePaul Movie Dataset</a>
    </li>
    <li>
      <a href="../../articles/replication.html">Offline evaluation: Replication of Li et al 2010</a>
    </li>
    <li>
      <a href="../../articles/simpsons.html">Demo: Bandits, Propensity Weighting &amp; Simpson's Paradox in R</a>
    </li>
    <li>
      <a href="../../articles/sutton_barto.html">Demo: Replication Sutton &amp; Barto, Reinforcement Learning: An Introduction, Chapter 2</a>
    </li>
    <li>
      <a href="../../articles/website_optimization.html">Demo: Replication of John Myles White, Bandit Algorithms for Website Optimization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
<li>
  <a href="../../articles/only_pkgdown/faq.html">FAQ</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Nth-iteration-labs/contextual">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Development FAQ</h1>
                        <h4 class="author">Robin van Emden</h4>
            
            <h4 class="date">2020-03-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Nth-iteration-labs/contextual/blob/master/vignettes/only_pkgdown/faq.Rmd"><code>vignettes/only_pkgdown/faq.Rmd</code></a></small>
      <div class="hidden name"><code>faq.Rmd</code></div>

    </div>

    
    
<div id="extending-contextual-frequently-asked-questions" class="section level2">
<h2 class="hasAnchor">
<a href="#extending-contextual-frequently-asked-questions" class="anchor"></a>Extending Contextual: Frequently Asked Questions</h2>
<ul>
<li><a href="#are-contextuals-arms-zero--or-one-based">Are contextual’s arms zero- or one-based?</a></li>
<li><a href="#what-is-this-selftheta_to_arms-list-i-see-in-some-policies">What is this “self$theta_to_arms” list I see in some Policies?</a></li>
<li><a href="#cannot-add-bindings-to-a-locked-environment">“Cannot add bindings to a locked environment”?</a></li>
<li><a href="#messages-from-bandits-and-policies-do-not-show-in-the-console">Messages from Bandits and Policies do not show in the console?</a></li>
<li><a href="#what-is-this-selftheta_to_arms-list-i-see-in-some-policies">What is this “self$theta_to_arms” list I see in some Policies?</a></li>
<li><a href="#why-are-my-custom-classes-slower-than-contextuals">Why are my custom classes slower than contextual’s?</a></li>
<li><a href="#where-do-i-instantiate-a-bandits-simulation-level-randomization">Where do I instantiate a Bandit’s simulation level-randomization?</a></li>
<li><a href="#what-is-this-public-class_name-member-in-every-bandit-and-policy">What is this public “class_name” member in every Bandit and Policy?</a></li>
<li><a href="#what-is-the-use-of-get_arm_context-and-get_full_context">What is the use of get_arm_context() and get_full_context()?</a></li>
<li><a href="#how-do-i-define-my-own-custom-regret-function">How do I define my own custom regret function?</a></li>
</ul>
</div>
<div id="are-contextuals-arms-zero--or-one-based" class="section level2">
<h2 class="hasAnchor">
<a href="#are-contextuals-arms-zero--or-one-based" class="anchor"></a>Are contextual’s arms zero- or one-based?</h2>
<p>In contextual, arms are one based. In other words, in contextual <code>k</code> arms are represented by <code>k &lt;- c(1,2,3,4,...)</code></p>
</div>
<div id="what-is-this-selftheta_to_arms-list-i-see-in-some-policies" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-this-selftheta_to_arms-list-i-see-in-some-policies" class="anchor"></a>What is this “self$theta_to_arms” list I see in some Policies?</h2>
<p>In many of contextual’s Policy’s set_parameters() initialisation function, a parameter list is being assigned to a “self$theta_to_arms”. But the parameters themselves are later only available through self$theta.</p>
<p>The following source code comments how this little helper variable is used:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>EpsilonFirstPolicy              &lt;-<span class="st"> </span>R6<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span>(</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="dt">inherit =</span> Policy,</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="dt">public =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="dt">first =</span> <span class="ot">NULL</span>,</span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="dt">class_name =</span> <span class="st">"EpsilonFirstPolicy"</span>,</span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="dt">initialize =</span> <span class="cf">function</span>(<span class="dt">epsilon =</span> <span class="fl">0.1</span>, <span class="dt">N =</span> <span class="dv">1000</span>) {</span>
<span id="cb1-7"><a href="#cb1-7"></a>      super<span class="op">$</span><span class="kw">initialize</span>()</span>
<span id="cb1-8"><a href="#cb1-8"></a>      self<span class="op">$</span>first                &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span>(epsilon<span class="op">*</span>N)</span>
<span id="cb1-9"><a href="#cb1-9"></a>    },</span>
<span id="cb1-10"><a href="#cb1-10"></a>    <span class="dt">set_parameters =</span> <span class="cf">function</span>(context_params) {</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a>      self<span class="op">$</span>theta_to_arms        &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">'n'</span> =<span class="st"> </span><span class="dv">0</span>, <span class="st">'mean'</span> =<span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a>      <span class="co"># Here we define a list with 'n' and 'mean' theta parameters to each</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>      <span class="co"># arm through helper variable self$theta_to_arms. That is, when the</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>      <span class="co"># number of arms is 'k', the above would equal:</span></span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a>      <span class="co"># self$theta &lt;- list(n = rep(list(0,k)), 'mean' = rep(list(0,k)))</span></span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a>      <span class="co"># ... which would also work just fine, but is much less concise.</span></span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a>      <span class="co"># When assigning both to self$theta directly &amp; via self$theta_to_arms,</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>      <span class="co"># make sure to do it in that particular order.</span></span>
<span id="cb1-24"><a href="#cb1-24"></a>    },</span>
<span id="cb1-25"><a href="#cb1-25"></a>    <span class="dt">get_action =</span> <span class="cf">function</span>(t, context) {</span>
<span id="cb1-26"><a href="#cb1-26"></a>      <span class="cf">if</span> (<span class="kw"><a href="../../reference/sum_of.html">sum_of</a></span>(self<span class="op">$</span>theta<span class="op">$</span>n) <span class="op">&lt;</span><span class="st"> </span>self<span class="op">$</span>first) {</span>
<span id="cb1-27"><a href="#cb1-27"></a>        action<span class="op">$</span>choice           &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample.int</a></span>(context<span class="op">$</span>k, <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-28"><a href="#cb1-28"></a>      } <span class="cf">else</span> {</span>
<span id="cb1-29"><a href="#cb1-29"></a>        action<span class="op">$</span>choice           &lt;-<span class="st"> </span><span class="kw">max_in</span>(self<span class="op">$</span>theta<span class="op">$</span>mean)</span>
<span id="cb1-30"><a href="#cb1-30"></a>      }</span>
<span id="cb1-31"><a href="#cb1-31"></a>      action</span>
<span id="cb1-32"><a href="#cb1-32"></a>    },</span>
<span id="cb1-33"><a href="#cb1-33"></a>    <span class="dt">set_reward =</span> <span class="cf">function</span>(t, context, action, reward) {</span>
<span id="cb1-34"><a href="#cb1-34"></a>      arm                       &lt;-<span class="st"> </span>action<span class="op">$</span>choice</span>
<span id="cb1-35"><a href="#cb1-35"></a>      reward                    &lt;-<span class="st"> </span>reward<span class="op">$</span>reward</span>
<span id="cb1-36"><a href="#cb1-36"></a>      <span class="kw">inc</span>(self<span class="op">$</span>theta<span class="op">$</span>n[[arm]])  &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-37"><a href="#cb1-37"></a>      <span class="cf">if</span> (<span class="kw"><a href="../../reference/sum_of.html">sum_of</a></span>(self<span class="op">$</span>theta<span class="op">$</span>n) <span class="op">&lt;</span><span class="st"> </span>self<span class="op">$</span>first <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb1-38"><a href="#cb1-38"></a>        <span class="kw">inc</span>(self<span class="op">$</span>theta<span class="op">$</span>mean[[arm]]) &lt;-</span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="st">           </span>(reward <span class="op">-</span><span class="st"> </span>self<span class="op">$</span>theta<span class="op">$</span>mean[[arm]]) <span class="op">/</span><span class="st"> </span>self<span class="op">$</span>theta<span class="op">$</span>n[[arm]]</span>
<span id="cb1-40"><a href="#cb1-40"></a>      }</span>
<span id="cb1-41"><a href="#cb1-41"></a>      self<span class="op">$</span>theta</span>
<span id="cb1-42"><a href="#cb1-42"></a>    }</span>
<span id="cb1-43"><a href="#cb1-43"></a>  )</span>
<span id="cb1-44"><a href="#cb1-44"></a>)</span></code></pre></div>
</div>
<div id="cannot-add-bindings-to-a-locked-environment" class="section level2">
<h2 class="hasAnchor">
<a href="#cannot-add-bindings-to-a-locked-environment" class="anchor"></a>“Cannot add bindings to a locked environment”?</h2>
<p>Contextual is build using the <code>R6</code> class system. In <code>R6</code>, you cannot create new attributes to <code>R6</code> objects just by assigning to $ indexed values as you can in S3. More information on <code>R6</code> in general and public and private members in particular can be found in the <a href="https://r6.r-lib.org/articles/Introduction.html">Introduction to R6 classes</a> vignette.</p>
</div>
<div id="messages-from-bandits-and-policies-do-not-show-in-the-console" class="section level2">
<h2 class="hasAnchor">
<a href="#messages-from-bandits-and-policies-do-not-show-in-the-console" class="anchor"></a>Messages from Bandits and Policies do not show in the console?</h2>
<p>By default, contextual’s agents are running in separate parallel worker processes. As these worker processes have no direct access to the R console, they can not be tracked there. But there are two options to keep track of Bandit and Policy progress and their messages. The first is to set Simulator’s <code>do_parallel</code> argument to <code>FALSE</code>. The second is to set Simulator’s <code>progress_file</code> argument to <code>TRUE</code>. If <code>TRUE</code>, Simulator writes <code>workers_progress.log</code>, <code>agents_progress.log</code> and <code>parallel.log</code> files to the current working directory, allowing you to keep track of respectively workers, agents, and potential errors when running a Simulator in parallel mode.</p>
</div>
<div id="how-do-i-use-r-packages-within-custom-bandits-and-policies" class="section level2">
<h2 class="hasAnchor">
<a href="#how-do-i-use-r-packages-within-custom-bandits-and-policies" class="anchor"></a>How do I use R packages within custom Bandits and Policies?</h2>
<p>If one of your custom Bandits or Policies requires a specific R package, use Simulator’s <code>include_packages</code> option to distribute the package(s) to each of a Simulator intance’s workers:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>simulator &lt;-<span class="st"> </span>Simulator<span class="op">$</span><span class="kw">new</span>(agents,</span>
<span id="cb2-2"><a href="#cb2-2"></a>                           <span class="dt">horizon =</span> 100L,</span>
<span id="cb2-3"><a href="#cb2-3"></a>                           <span class="dt">simulations =</span> 100L,</span>
<span id="cb2-4"><a href="#cb2-4"></a>                           <span class="dt">include_packages =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"rstan"</span>,<span class="st">"plyr"</span>))  <span class="co"># &lt;- distributes package(s) </span></span>
<span id="cb2-5"><a href="#cb2-5"></a>                                                                  <span class="co">#    to parallel workers</span></span></code></pre></div>
<p>It is then good practice to use a double colon operator to access some function from any included packages:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># At the top of a custom Bandit or Policy R file</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(testthat)</span>
<span id="cb3-3"><a href="#cb3-3"></a>Bandit &lt;-<span class="st"> </span>R6<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span>(</span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="dt">class    =</span> <span class="ot">FALSE</span>,</span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="dt">public   =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb3-6"><a href="#cb3-6"></a>    ...</span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="co"># Within a custom Bandit or Policy</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>    fit &lt;-<span class="st"> </span>stan<span class="op">::</span><span class="kw">stan</span>(...)</span>
<span id="cb3-9"><a href="#cb3-9"></a>    ...</span>
<span id="cb3-10"><a href="#cb3-10"></a>)</span></code></pre></div>
</div>
<div id="why-are-my-custom-classes-slower-than-contextuals" class="section level2">
<h2 class="hasAnchor">
<a href="#why-are-my-custom-classes-slower-than-contextuals" class="anchor"></a>Why are my custom classes slower than contextual’s?</h2>
<p>Contextual makes ample use of the <code>data.table</code> package, which, if used the “data.table way”, can speed up in-memory data related operations substantially. For more infomation on <code>data.table</code>, see the <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">Intro to data.table</a> vignette, and, for instance, this <a href="https://www.datacamp.com/community/tutorials/data-table-cheat-sheet">data.table cheat sheet</a>.</p>
<p>That does not imply that this is the only way to go - contextual’s Bandits and Policies make use of basic (fast) matrix based operations as well, and its Simulation and offline Bandits have been extended to, among others, read and write to and from the super fast open-source column-oriented Monet database management system.</p>
</div>
<div id="where-do-i-instantiate-a-bandits-simulation-level-randomization" class="section level2">
<h2 class="hasAnchor">
<a href="#where-do-i-instantiate-a-bandits-simulation-level-randomization" class="anchor"></a>Where do I instantiate a Bandit’s simulation level-randomization?</h2>
<p>Bandit <code>initialization()</code> function is called before Bandit and Policy clones are distributed simulations. So generally, it is advisable to randomize within Bandits’ <code><a href="../../reference/Bandit.html">post_initialization()</a></code> function, which is called right before starting every simulation.</p>
<p>Here, contextual’s Simulator class ensures that every Policy and Bandit pair (bound by their shared Agent) will run their simulations on a deterministically set of seeds, ensuring both replicability and fair comparisons between agents.</p>
</div>
<div id="what-is-this-public-class_name-member-in-every-bandit-and-policy" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-this-public-class_name-member-in-every-bandit-and-policy" class="anchor"></a>What is this public “class_name” member in every Bandit and Policy?</h2>
<p>Contextual uses the public “class_name” member internally to keep track of Policy’s and Bandit’s, and to, among others, generate names for Agents’ that have not been named explicitly. So don’t forget to include it in your own custom Bandit’s and Policies!</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">#' @export</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>LinUCBDisjointOptimizedPolicy &lt;-<span class="st"> </span>R6<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span>(     <span class="co"># &lt;-- not directly accessible to contextual</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="dt">portable =</span> <span class="ot">FALSE</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="dt">class =</span> <span class="ot">FALSE</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="dt">inherit =</span> Policy,</span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="dt">public =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="dt">alpha =</span> <span class="ot">NULL</span>,</span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="dt">class_name =</span> <span class="st">"LinUCBDisjointOptimizedPolicy"</span>,  <span class="co"># &lt;-- so Bandits and Policies need class_name too</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="dt">initialize =</span> <span class="cf">function</span>(<span class="dt">alpha =</span> <span class="fl">1.0</span>) {</span>
<span id="cb4-10"><a href="#cb4-10"></a>      super<span class="op">$</span><span class="kw">initialize</span>()</span>
<span id="cb4-11"><a href="#cb4-11"></a>      self<span class="op">$</span>alpha &lt;-<span class="st"> </span>alpha</span>
<span id="cb4-12"><a href="#cb4-12"></a>    },</span>
<span id="cb4-13"><a href="#cb4-13"></a>    ...</span></code></pre></div>
</div>
<div id="what-is-the-use-of-get_arm_context-and-get_full_context" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-the-use-of-get_arm_context-and-get_full_context" class="anchor"></a>What is the use of get_arm_context() and get_full_context()?</h2>
<p>Contextual passes a “context” list object between Bandit and Policy for each time step t. This object contains, for every  = {1, … , T}, a <code>d</code> dimensional feature vector or <code>d x k</code> dimensional matrix <code>context$X</code>, the current number of <code>Bandit</code> arms in <code>context$k</code>, and the current number of contextual features in <code>context$d</code>.</p>
<p>To transparently support <code>Bandits</code> generating either contextual feature vectors or matrices, <code>contextual</code>’s <code>Policies</code> generally use the <code><a href="../../reference/get_arm_context.html">get_arm_context(context, arm)</a></code> utility function to obtain the current <code>X</code> for a particular arm, or the <code><a href="../../reference/get_full_context.html">get_full_context(context)</a></code> utility function to obtain the full <code>d x k</code> context matrix.</p>
<p>The functions additionally support returning a subset of all context features through its <code>select_features</code> arguments, and they can respectively prepend a “one hot encoded” style arm vector or diagonal arm matrix through their <code>prepend_arm_vector</code> arguments.</p>
</div>
<div id="how-do-i-define-my-own-custom-regret-function" class="section level2">
<h2 class="hasAnchor">
<a href="#how-do-i-define-my-own-custom-regret-function" class="anchor"></a>How do I define my own custom regret function?</h2>
<p>In the <code>get_reward()</code> function of a <code>Bandit</code> you can set both the <code>reward</code>, and the <code>optimal reward</code>.</p>
<p>When both have been set, <code>contextual</code> then knows to subtract the former from the latter to obtain the <code>regret</code>.</p>
<p>For example, see <code>BasicBernoulliBandit</code>’s implementation:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">#' @export</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>BasicBernoulliBandit &lt;-<span class="st"> </span>R6<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span>(</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="dt">inherit =</span> Bandit,</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="dt">class =</span> <span class="ot">FALSE</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="dt">public =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="dt">weights =</span> <span class="ot">NULL</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="dt">class_name =</span> <span class="st">"BasicBernoulliBandit"</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>    <span class="dt">initialize =</span> <span class="cf">function</span>(weights) {</span>
<span id="cb5-9"><a href="#cb5-9"></a>      self<span class="op">$</span>weights     &lt;-<span class="st"> </span>weights</span>
<span id="cb5-10"><a href="#cb5-10"></a>      self<span class="op">$</span>k           &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(self<span class="op">$</span>weights)</span>
<span id="cb5-11"><a href="#cb5-11"></a>    },</span>
<span id="cb5-12"><a href="#cb5-12"></a>    <span class="dt">get_context =</span> <span class="cf">function</span>(t) {</span>
<span id="cb5-13"><a href="#cb5-13"></a>      context &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb5-14"><a href="#cb5-14"></a>        <span class="dt">k =</span> self<span class="op">$</span>k</span>
<span id="cb5-15"><a href="#cb5-15"></a>      )</span>
<span id="cb5-16"><a href="#cb5-16"></a>    },</span>
<span id="cb5-17"><a href="#cb5-17"></a>    <span class="dt">get_reward =</span> <span class="cf">function</span>(t, context, action) {</span>
<span id="cb5-18"><a href="#cb5-18"></a>      rewards        &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/double.html">as.double</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(self<span class="op">$</span>k) <span class="op">&lt;</span><span class="st"> </span>self<span class="op">$</span>weights)</span>
<span id="cb5-19"><a href="#cb5-19"></a>      optimal_arm    &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/which_max_tied.html">which_max_tied</a></span>(self<span class="op">$</span>weights)</span>
<span id="cb5-20"><a href="#cb5-20"></a>      reward  &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb5-21"><a href="#cb5-21"></a>        <span class="dt">reward                   =</span> rewards[action<span class="op">$</span>choice],    <span class="co"># &lt;- reward here</span></span>
<span id="cb5-22"><a href="#cb5-22"></a>        <span class="dt">optimal_arm              =</span> optimal_arm,               </span>
<span id="cb5-23"><a href="#cb5-23"></a>        <span class="dt">optimal_reward           =</span> rewards[optimal_arm]       <span class="co"># &lt;- optimal reward here</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>      )</span>
<span id="cb5-25"><a href="#cb5-25"></a>    }</span>
<span id="cb5-26"><a href="#cb5-26"></a>  )</span></code></pre></div>
<p>…</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#extending-contextual-frequently-asked-questions">Extending Contextual: Frequently Asked Questions</a></li>
      <li><a href="#are-contextuals-arms-zero--or-one-based">Are contextual’s arms zero- or one-based?</a></li>
      <li><a href="#what-is-this-selftheta_to_arms-list-i-see-in-some-policies">What is this “self$theta_to_arms” list I see in some Policies?</a></li>
      <li><a href="#cannot-add-bindings-to-a-locked-environment">“Cannot add bindings to a locked environment”?</a></li>
      <li><a href="#messages-from-bandits-and-policies-do-not-show-in-the-console">Messages from Bandits and Policies do not show in the console?</a></li>
      <li><a href="#how-do-i-use-r-packages-within-custom-bandits-and-policies">How do I use R packages within custom Bandits and Policies?</a></li>
      <li><a href="#why-are-my-custom-classes-slower-than-contextuals">Why are my custom classes slower than contextual’s?</a></li>
      <li><a href="#where-do-i-instantiate-a-bandits-simulation-level-randomization">Where do I instantiate a Bandit’s simulation level-randomization?</a></li>
      <li><a href="#what-is-this-public-class_name-member-in-every-bandit-and-policy">What is this public “class_name” member in every Bandit and Policy?</a></li>
      <li><a href="#what-is-the-use-of-get_arm_context-and-get_full_context">What is the use of get_arm_context() and get_full_context()?</a></li>
      <li><a href="#how-do-i-define-my-own-custom-regret-function">How do I define my own custom regret function?</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Robin van Emden.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '7d3ef95d72d5a68e705ce87f9919b959',
    indexName: 'nth_iteration_labs_contextual',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
